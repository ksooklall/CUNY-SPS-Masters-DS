---
title: Readmission rates fo Type 2 Diabetics
author:
  - name: Kenan Sooklall
    email: ksooklall100@gmail.com
    affiliation: CUNY-SPS
    footnote: Corresponding Author
address:
  - address: CUNY School of Professional Studies
layout: 5p
abstract: |
  Type 2 diabetes is a disease that affects many around the world and continues to cause wide ranging problems. In this paper three models with various combinations of features that involve patient admission id, diabetic drug use, lab data and others were trained to predict the probability of a patient being readmitted. The results enforce the difficulties of making predictions with patients affected by type 2 diabetes. The first two models have an F1-score of 55% while the last got to 60% on the test set. Age always played a large role in predicting readmission followed by A1C result and blood glucose level. Diabetic drugs Metformin and glipizide Many were determined to be important in a patient being readmitted. The initial cause of the hospital visit, ie. emergency, trauma, were determined to be the most important variable.
date: "2022-05-03"
output: rticles::elsevier_article
---
```{r, echo=F, warning=F, message=F}
library(tidyverse)
library(knitr)
library(kableExtra)
path = '/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/'
```

### Introduction

Type 2 diabetes has reached epidemic proportions worldwide. According to the WHO diabetes has entered the top 10 causes of death, following a significant percentage increase of 70% since 2000. Diabetes is also responsible for the largest rise in male deaths among the top 10, with an 80% increase since 2000. Diabetes is a group of diseases that affect insulin production and use. In type 1 diabetes, the pancreas can’t produce insulin. The cause isn’t known. In type 2 diabetes, the pancreas doesn’t produce enough insulin, or insulin can’t be used effectively. Type 2 diabetes can be caused by a number of factors, including poor diet, lack of exercise, and being overweight.

Throughout this paper diabetes is a shorthand for type 2 diabetes.

### Preprocessing

The data set was obtained from UC Irvine and contains 101766 rows and 50 columns. The patient column contains 71518 unique patients with 28784 readmitted and 28781 not readmitted. To avoid over fitting on a single patient all duplicated patient data was dropped. Then downsampling was conducted for the minority class leaving the data set with 57568 rows. The 50 columns can be broken down in to 5 parts, admission data, lab diagnosis, patient details, diagnosis data and diabetic drugs, Table 1.

The data set has "?" to signify a missing value, so "?" were replaced with NaNs for all columns. The weight, payer code and medical specialty were dropped for having too many NaNs. Drug columns examide, citoglipton and glimepiride-pioglitazone were dropped because they only had 1 unique value.
Encounter ID was dropped as it doesn't provide any informative information. Race was dropped as it might make the model not useful and can lead to uninformative result.

The target column readmitted was transformed with NO as 0 and all other values as 1. This remapping transforms readmitted from 3 unique values to 2, changing this analysis to binary classification. The age column was bucketed into young (age<30), adult (30<age<60) and old (age>60) then one hot encoded.

The diagnosis columns diag_1,2 and 3 were mapped according to the icd9 codes, then one hot encoded.
The drug columns were mapped NO as 0 and all other values as 1. The only NaN rows were diagnosis, so they were all dropped as imputation is not possible.

Admission type ID, Discharge disposition ID and Admission source ID were mapping according to the source paper with a few major changes. Discharge disposition ID was reduced to "other" , "home" and NaN. Admission source ID was reduced to "emergency", "referral", "other" and NaN. Admission type ID was not changed from the source except replacing NULL and not available with NaN.

Columns to great interest are glucose serum test result and A1c test result. Glucose serum test is a numeric value that measures blood sugar level, a value of 126 mg/dL or higher indicates the patient is diabetic. The A1C test measures the percentage of your red blood cells that have sugar-coated hemoglobin, a value of 6.5% or above indicates the patient is diabetic.

\clearpage
\onecolumn

```{r, echo=F, warning=F, message=F}
df <- read.csv('/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/column_data.csv')
kable(df) %>% 
  kable_paper(full_width = F) %>% 
  column_spec(1,  bold = T, border_left = T, width = "9em") %>% 
  column_spec(2, background='yellow') %>%
  column_spec(3, width = "35em") %>% 
  column_spec(4, width = "1em")
```

\clearpage
\twocolumn


### Exploratory Data Analysis

The data set is slightly skewed with 42982 (60%) patients not being readmitted and 28533 (40%) readmitted. Gender is well balanced at 53% male and 47% female. Age is skewed more toward the older population, which is expected for a disease that is more common in the older population. All other numeric variables follow a similar distribution.

There is a weak relationship with drugs taken and a patient being readmitted. The only drug with a high readmission is insulin which is expected since insulin plays a major role in a patient becoming diabetic. Figure NUM shows that most of the readmitting comes from older individuals with high A1C results, with 1200+ patients have greater than 88%. Surprisingly some adults and youngsters who were not readmitted also have high A1C results, greater than 8%. 

Figure NUM shows how time in hospital is right skewed with no distinction between the target. Figure NUM-NUM shoes the number of lab procedures and number of medications are normally distributed with the former having a spike at the start and the ladder being slightly right skewed. As seen from Figure NUM the number of diagnoses has a spike at 9 with more individual being readmitted, after that the count is less than 20.  

Figure NUM doesn't show a distinction between age and glucose serum test for those who were readmitted. The older population is represented the most and the younger population the least.


![Age vs Readmission](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/age.jpg){#id .class width=300 height=200px}

![A1Cresults vs readmission](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/A1Cresults.jpg){#id .class width=300 height=200px}

![Max Glucose Serum vs readmission](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/max_glucose_serum.jpg){#id .class width=300 height=200px}

\clearpage
\twocolumn

### Modeling

SVM, Logistic Regression and Random Forest Classifier were trained with cross validation using different combinations of features. Model hyper parameters were tuned with grid search. The dataset was split into training and testing with the test set containing 15% of the data. The best models were fitted to the training set with the best parameters and then feature importances are plotted.
Numeric columns were standardized by subtracting the mean and dividing by the standard deviation thus having a mean of 0 and std of 1. All other columns were fed into the model without further processing.

The first dataset used all features, lab data, drug data and patient data. 
 - features: gender, old, young, adult, time_in_hospital, num_lab_procedures, num_procedures, num_medications, number_diagnoses, diabetesMed, change, max_glu_serum_num, A1Cresult_num
 - num_cols = [time_in_hospital,num_lab_procedures, num_medications,number_diagnoses]

The results produced very similar scores for all models with random forest producing the best. The results of the random forest are in Table NUM and feature importance in Figure NUM. The number of lab procedures and number of medications played the strongest role in model prediction followed by the time in hospital. These features make intuitive sense since someone how is taking a lot of medications and has to stay in the hospital for extended period of times will be someone that might return.

The second dataset contained all features that were determined to be important through the exploratory data analysis except the drug columns. Again there was similar results with model performances. The features of importance are shown in Figure NUM. Age and gender have the lowest importance while A1C result and glucose levels were the highest. 

The last round of modeling is done with glucose serum test result and A1C test result as those are the features that a patient can control through diet or exercise. Age was also added to this dataset to see if it plays a bigger role. The dataset was filter for rows that only contain values for both features leaving 208 rows. Both glucose serum test and A1c test results were one hot encoded. 

\clearpage
\onecolumn

TABLEs and FEATURE IMPORTANCE PLOTS

\clearpage
\twocolumn
### Results and Dicussion

Diabetes is a very complex disease and this analysis has shown how difficult it is to predict and manage once a patient is positive. The 3 models build from various combinations of features produced slight better predictions than flipping a coin. The last two models show that managing A1C results and blood glucose levels play a very important role in being readmitted. Another important variable that we have no control over is age.

Other features like time_in_hospital, num_lab_procedures, number_diagnoses and num_medications didn't play as large a role as what we would have expected; however the eda did propose that fact. When all features were used the reason for admission and discharge scored the highest in feature importance. 

The last model highlighted the importance of age even if one has good control of their A1C and blood glucose. Although it's not explicitly stated the process of a patient passing away after initial admission (readmittiong = 0) explain the initial skewness of the data.


\clearpage
\onecolumn

```{r, echo=F}
df <- read.csv(paste0(path, '/m1_classification_report.csv'))
kable(df, caption='Model 1 Classification Report')
```

![Model 1 Feature Importance](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/m1_feature_importance.jpg){#id .class width=600 height=300px}

```{r, echo=F}
df <- read.csv(paste0(path, '/m2_classification_report.csv'))
kable(df, caption='Model 2 Classification Report')
```

![Model 2 Feature Importance](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/m2_feature_importance.jpg){#id .class width=600 height=300px}

```{r, echo=F}
df <- read.csv(paste0(path, '/m3_classification_report.csv'))
kable(df, caption='Model 3 Classification Report')
```

![Model 3 Feature Importance](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/m3_feature_importance.jpg){#id .class width=600 height=300px}
```{r, echo=F}
df <- read.csv(paste0(path, '/m3_classification_report.csv'))
kable(df, caption='Model 4 Classification Report')
```

![Model 4 Feature Importance](/home/kenan/Documents/learning/masters/CUNY-SPS-Masters-DS/DATA_698/graphs/m3_feature_importance.jpg){#id .class width=600 height=300px}


\clearpage
\twocolumn
### Conclusion

According to the mayo clinic type 2 diabetes is disease in the way the body regulates and uses glucose as a fuel. This long-term (chronic) condition results in too much sugar circulating in the bloodstream. Eventually, high blood sugar levels can lead to disorders of the circulatory, nervous and immune systems. Although there are many diabetic medication metformin and glipizide showed large importance followed by insulin. The reason a diabetic patient goes to the hospital is the most important factor iin determining if they will be readmitted in the future.


### References

https://www.cdc.gov/diabetes/basics/getting-tested.html#:~:text=This%20measures%20your%20blood%20sugar,higher%20indicates%20you%20have%20diabetes.

https://www.mayoclinic.org/diseases-conditions/type-2-diabetes/symptoms-causes/syc-20351193

